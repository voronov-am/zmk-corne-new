# agents.md

Этот файл содержит инструкции для Claude Code (claude.ai/code) при работе с этим репозиторием.

## Обзор проекта

Этот репозиторий управляет прошивкой ZMK для разделенной клавиатуры Corne с поддержкой Bluetooth, используя контроллеры NRF 52840 (совместимые с nice nano). Настройка включает поддержку русской раскладки клавиатуры и интеграцию с онлайн-редактором раскладок.

## Конфигурация оборудования

- **Клавиатура**: Corne split keyboard (42 клавиши)
- **Контроллеры**: Pro Micro NRF 52840 (совместимые с nice nano)
- **Подключение**: Bluetooth
- **Платформа**: macOS

## Структура репозитория

### Конфигурация ZMK (основные файлы)
- `build.yaml` - Матрица сборки для GitHub Actions (board: nice_nano)
- `.github/workflows/build.yml` - GitHub Actions workflow для автоматической сборки
- `/config/` - Директория конфигурации ZMK
  - `corne.keymap` - Раскладка клавиатуры
  - `corne.conf` - Настройки прошивки (Bluetooth, сон, дисплей)
  - `west.yml` - Манифест зависимостей ZMK

### Справочные материалы
- `/clear_firmware` - Прошивка сброса (zmk.hex, zmk.uf2), используется для очистки клавиатуры перед прошивкой новой прошивки
- `/factory_firmware` - Работающая заводская прошивка для клавиатуры jorne (левая/правая половинки)
- `/firmware` - Пользовательские скомпилированные версии прошивки для клавиатуры corne (левая/правая половинки)
- `keys_ru.h` - Заголовок с русской раскладкой, содержащий коды ZMK HID, отображающие кириллические символы на позиции QWERTY
- `/docs` - Инструкции по настройке и руководства по устранению неполадок (на русском языке)
- `README.md` - Полное руководство по использованию репозитория

## Процесс прошивки

Процесс прошивки следует этим шагам:

1. **Забыть устройство** - Удалить клавиатуру из параметров Bluetooth на macOS
2. **Очистить прошивку** - Подключить половинку через USB, дважды нажать кнопку сброса (красный светодиод мигает), скопировать оба файла zmk.hex и zmk.uf2 на устройство, повторить для другой половинки
3. **Залить прошивку** - Подключить половинку через USB, дважды нажать сброс, скопировать файл .uf2 для этой половинки (сначала правая, потом левая)
4. **Сброс** - Однократно нажать кнопку сброса на обоих половинках
5. **Переподключиться** - Подключить к macOS через Bluetooth

Примечание: Ошибки отключения диска во время прошивки - нормальное поведение.

## Конфигурация раскладки

Раскладки настраиваются с использованием веб-редактора раскладок на https://nickcoutsos.github.io/keymap-editor/, который подключается к репозиториям GitHub.

**Текущий репозиторий:**
- GitHub: https://github.com/ladkin/zmk-corne-new
- Использует правильный board: nice_nano (исправлена ошибка nice_nano_v2)
- Включает settings_reset для корректного сброса настроек

**Старые репозитории (не использовать):**
- https://github.com/ladkin/zmk-config-corne - проблемы с Bluetooth
- https://github.com/ladkin/zmk-config - ошибки сборки (неправильный board: nice_nano_v2)

При изменении раскладок:
- Изменения сохраняются в выбранном репозитории/ветке GitHub
- GitHub Actions автоматически собирает прошивку
- Скачать созданные файлы .uf2 из раздела Actions → Artifacts
- Залить их, используя процесс выше

## Сборка прошивки

После коммита в репозиторий GitHub Actions автоматически соберёт 3 файла:
1. `corne_left-nice_nano-zmk.uf2` - левая половинка
2. `corne_right-nice_nano-zmk.uf2` - правая половинка
3. `settings_reset-nice_nano-zmk.uf2` - сброс настроек

Скачать готовые прошивки можно в разделе Actions → выбрать последний успешный workflow → Artifacts

## Полезные ресурсы

- https://typus.ru/firmware_builds - Сборки прошивок
- https://typus.ru/zmk - Информация о ZMK
- https://key-test.ru/ - Инструмент тестирования клавиатуры
- https://github.com/aroum/Watchman-layouts - Примеры раскладок
